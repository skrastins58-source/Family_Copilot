name: Flutter Web Docker Build

on:
  pull_request:
    paths:
      - Dockerfile
      - .dockerignore
      - web/**
      - pubspec.yaml
      - pubspec.lock

jobs:
  build-and-validate:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ³ Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: ğŸ” Validate .dockerignore presence
        run: |
          test -f .dockerignore && echo ".dockerignore found âœ…" || exit 1

      - name: ğŸ—ï¸ Build Docker image
        run: |
          docker build -t flutter-web-app .

      - name: âœ… Sanity check build output
        run: |
          docker run --rm flutter-web-app test -f /usr/share/nginx/html/index.html

      - name: ğŸ“¦ Optional:Save image as artifact
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: flutter-web-app-image
          path: /usr/share/nginx/html
